<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Redirecting...</title>
  <script>
    const FORM_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLSdMVH6rsGtas1HFxL6ada_tr7sQxFs5iQTspgq8sp0iSpZV7A/formResponse";
    const FIELD_IDS = {
      siteid: "entry.897794614",
      country: "entry.577451125",
      os: "entry.937726090",
      device: "entry.912828124",
      browser: "entry.760224698",
      connection: "entry.1309151960",
      isBot: "entry.956650261",
      status: "entry.1336793015"
    };

    function getQueryParams() {
      const params = {};
      window.location.search.substring(1).split("&").forEach(pair => {
        const [key, value] = pair.split("=");
        if (key && value) {
          params[decodeURIComponent(key)] = decodeURIComponent(value);
        }
      });
      return params;
    }

    function isBot() {
      const ua = navigator.userAgent.toLowerCase();
      const hasHeadlessProps = /headless|phantom|slimerjs|selenium|webdriver|puppeteer|crawl|spider|bot|curl|wget|python|scrapy/i.test(ua);
      const noPlugins = navigator.plugins.length === 0;
      const isAutomation = navigator.webdriver || window.chrome?.runtime === undefined;
      const isTouchless = !('ontouchstart' in window);

      return hasHeadlessProps || noPlugins || isAutomation || isTouchless;
    }

    function sendToGoogleForm(data) {
      const formData = new FormData();
      formData.append(FIELD_IDS.siteid, data.siteid);
      formData.append(FIELD_IDS.country, data.country);
      formData.append(FIELD_IDS.os, data.os);
      formData.append(FIELD_IDS.device, data.device);
      formData.append(FIELD_IDS.browser, data.browser);
      formData.append(FIELD_IDS.connection, data.connection);
      formData.append(FIELD_IDS.isBot, data.isBot);
      formData.append(FIELD_IDS.status, data.status);

      navigator.sendBeacon(FORM_ACTION, formData);
    }

    window.onload = function () {
      const params = getQueryParams();
      const botFlag = isBot();

      const data = {
        siteid: params.siteid || "unknown",
        country: params.cc || "unknown",
        os: params.operatingsystem || "unknown",
        device: params.device || "unknown",
        browser: navigator.userAgent,
        connection: params.connection || "unknown",
        isBot: botFlag ? "true" : "false",
        status: botFlag ? "Bot" : "Real"
      };

      sendToGoogleForm(data);

      const redirectUrl = botFlag
        ? "https://example.com"
        : "https://www.google.com/";

      // Use slight delay to allow beacon to fire
      setTimeout(() => {
        window.location.href = redirectUrl;
      }, 100);
    };
  </script>
</head>
<body>
  <p>Redirecting, please wait...</p>
</body>
</html>
