<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <script>
    const FORM_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLSdMVH6rsGtas1HFxL6ada_tr7sQxFs5iQTspgq8sp0iSpZV7A/formResponse";
    const FIELD_IDS = {
      siteid: "entry.897794614",
      country: "entry.577451125",
      os: "entry.937726090",
      device: "entry.912828124",
      browser: "entry.760224698",
      connection: "entry.1309151960",
      isBot: "entry.956650261",
      status: "entry.1336793015"
    };

    function getQueryParams() {
      const params = {};
      window.location.search.substring(1).split("&").forEach(pair => {
        const [key, value] = pair.split("=");
        if (key && value) {
          params[decodeURIComponent(key)] = decodeURIComponent(value);
        }
      });
      return params;
    }

    async function isProxyOrVPN() {
      // Try both ipapi and ipinfo for redundancy
      try {
        let proxy = false;
        let org = "", asn = "", hostname = "", anyHint = "";
        // First, ipapi.co
        let res = await fetch("https://ipapi.co/json/");
        if (res.ok) {
          let json = await res.json();
          org = (json.org || '').toLowerCase();
          anyHint = (json.abuse || '') + (json.version || '');
          if (org.includes("vpn") || org.includes("proxy") || org.includes("hosting") || org.includes("cloud")) proxy = true;
        }
        // Second, try ipinfo.io if not detected
        if (!proxy) {
          res = await fetch("https://ipinfo.io/json");
          if (res.ok) {
            let json = await res.json();
            org = (json.org || '').toLowerCase();
            hostname = (json.hostname || '').toLowerCase();
            asn = (json.asn && json.asn.name ? json.asn.name.toLowerCase() : '');
            if (
              org.includes("vpn") || org.includes("proxy") || org.includes("cloud") || org.includes("hosting") ||
              hostname.includes("vpn") || hostname.includes("proxy") ||
              asn.includes("vpn") || asn.includes("proxy") || asn.includes("cloud") || asn.includes("hosting")
            ) {
              proxy = true;
            }
          }
        }
        return proxy;
      } catch (e) {
        return false;
      }
    }

    function isLikelyBot() {
      const ua = navigator.userAgent;
      const suspiciousUA = /bot|crawl|spider|googlebot|curl|wget|headless|phantom|selenium|puppeteer|python|http|fetch|java|scrapy|harvest|slurp|apex|datadog|monitor/i.test(ua);
      const automation = navigator.webdriver === true;
      const plugins = navigator.plugins && navigator.plugins.length === 0;
      const languages = !navigator.languages || navigator.languages.length === 0;
      const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
      const memory = navigator.deviceMemory && navigator.deviceMemory < 1;
      const concurrency = navigator.hardwareConcurrency && navigator.hardwareConcurrency < 2;
      // Headless Chrome detection
      const isHeadless = /HeadlessChrome/.test(ua) ||
        window.chrome === undefined ||
        window.outerWidth === 0 ||
        window.outerHeight === 0;
      // Touch+Desktop mismatches
      const touchMismatch = (hasTouch && /windows|macintosh|linux/i.test(ua) && !/android|iphone|ipad|mobile/i.test(ua));
      return (
        suspiciousUA ||
        automation ||
        plugins ||
        languages ||
        isHeadless ||
        touchMismatch ||
        (memory && concurrency)
      );
    }

    (async function () {
      const params = getQueryParams();
      const botFlag = isLikelyBot() || await isProxyOrVPN();
      console.log("Bot or Proxy Detection Result:", botFlag);

      const data = {
        siteid: params.siteid || "unknown",
        country: params.cc || "unknown",
        os: params.operatingsystem || "unknown",
        device: params.device || "unknown",
        browser: navigator.userAgent,
        connection: params.connection || "unknown",
        isBot: botFlag ? "true" : "false",
        status: botFlag ? "Bot/Proxy" : "Real"
      };

      try {
        const formData = new FormData();
        for (const key in data) {
          formData.append(FIELD_IDS[key], data[key]);
        }
        navigator.sendBeacon(FORM_ACTION, formData);
      } catch (e) {
        console.warn("Beacon failed:", e);
      }

      const redirectUrl = botFlag
        ? "https://example.com"
        : "https://www.google.com/";

      window.location.replace(redirectUrl);
    })();
  </script>
  <style>body{display:none;}</style>
</head>
<body></body>
</html>
